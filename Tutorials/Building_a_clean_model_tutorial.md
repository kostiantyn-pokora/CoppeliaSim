# Посібник зі створення чистої моделі #
Цей навчальний посібник допоможе вам крок за кроком створити чисту імітаційну модель робота чи будь-якого іншого предмета. Це дуже важлива тема, можливо, найважливіший аспект, щоб мати приємну на вигляд, швидку відображення, швидку симуляцію та стабільну імітаційну модель.
Щоб проілюструвати процес створення моделі, ми створимо наступний маніпулятор:

![modelTut1](modelTut1.jpg)

[Модель робота-маніпулятора]

## Побудова видимих фігур ##
Створюючи нову модель, спочатку ми обробляємо лише її візуальний аспект: динамічний аспект (його ще більш спрощена/оптимізована модель), з’єднання, датчики тощо буде розглянуто пізніше.

Тепер ми могли безпосередньо створювати примітивні форми в CoppeliaSim за допомогою [Рядок меню --> Додати --> Примітивна форма --> ...]. Роблячи це, ми маємо можливість створювати примітивні форми, або правильні форми. Примітивні фігури будуть оптимізовані для динамічної взаємодії, а також будуть безпосередньо активовані динамічно (тобто падіння, зіткнення, але це можна вимкнути на пізнішому етапі). Примітивні форми будуть простими сітками, які можуть містити недостатньо деталей або геометричної точності для нашого застосування. Іншим нашим варіантом у такому випадку буде імпорт сітки із зовнішньої програми.

Під час імпорту даних САПР із зовнішньої програми найважливішим є переконатися, що модель САПР не надто важка, тобто не містить занадто багато трикутників. Ця вимога важлива, оскільки важка модель буде повільно відображатися, а також уповільнити роботу різних модулів обчислень, які можуть бути використані на пізнішому етапі (наприклад, обчислення мінімальної відстані або динаміки). Наступний приклад зазвичай не підходить (навіть якщо, як ми побачимо пізніше, є засоби для спрощення даних у CoppeliaSim):

![modelTut2](modelTut2.jpg)

[Складні дані САПР (у твердому та каркасному)]

Наведені вище дані CAD дуже важкі: вони містять багато трикутників (понад 47 000), що було б добре, якби ми використали лише один екземпляр у порожній сцені. Але здебільшого вам захочеться змоделювати кілька екземплярів одного робота, прикріпити різні типи захватів і, можливо, запропонувати цим роботам взаємодіяти з іншими роботами, пристроями чи середовищем. У такому випадку сцена симуляції може швидко стати надто повільною. Як правило, ми рекомендуємо моделювати робота з не більше ніж 20 000 трикутниками, але в більшості випадків 5 000-10 000 трикутників також підійдуть. Пам’ятайте: менше – краще майже в усіх аспектах.
Що робить цю модель такою важкою? По-перше, моделі, які містять отвори та дрібні деталі, потребуватимуть набагато більше трикутних граней для правильного зображення. Тому, якщо це можливо, спробуйте видалити всі отвори, гвинти, внутрішню частину об’єктів тощо з вихідних даних моделі. Якщо у вас є вихідні дані моделі, представлені у вигляді параметричних поверхонь/об’єктів, у більшості випадків досить просто вибрати елементи та видалити їх (наприклад, у Solidworks). Другим важливим кроком є експорт вихідних даних з обмеженою точністю: більшість програм САПР дозволяють вказати рівень деталей експортованих сіток. Також може бути важливо експортувати об’єкти в кілька кроків, коли малюнок складається з великих і малих об’єктів; це робиться для того, щоб уникнути надто точного визначення великих об’єктів (забагато трикутників) і надто грубого визначення малих об’єктів (замало трикутників): просто спочатку експортуйте великі об’єкти (налаштувавши потрібні параметри точності), а потім малі об’єкти (налаштувавши налаштування точності) ).

Тепер припустимо, що ми застосували всі можливі спрощення, як описано в попередньому розділі. Ми все ще можемо отримати занадто важку сітку після імпорту:

![modelTut3](modelTut3.jpg)

[Імпортовані дані CAD]

Ви можете помітити, що весь робот був імпортований як одна сітка. Пізніше ми побачимо, як це правильно розділити. Зверніть також увагу на неправильну орієнтацію імпортованої сітки: найкраще залишити орієнтацію такою, як вона є, доки не буде побудовано всю модель, оскільки, якщо на пізнішому етапі ми захочемо імпортувати інші елементи, пов’язані з тим самим роботом, вони будуть автоматично маюти правильне положення/орієнтацію відносно вихідної сітки.
На цьому етапі ми маємо в своєму розпорядженні кілька функцій для спрощення сітки:

- Автоматичне поділ сітки: дозволяє генерувати нову форму для всіх елементів, які не з’єднані між собою спільним краєм. Це не завжди працює для вибраної сітки, але завжди варто спробувати, оскільки робота над елементами сітки дає нам більше контролю, ніж якби ми мали працювати над усіма елементами одночасно. Доступ до цієї функції можна отримати за допомогою [Menu bar --> Edit --> Grouping/Merging --> Divide selected shapes]. Іноді сітка буде розділена більше, ніж очікувалося. У такому випадку просто об’єднайте елементи, які логічно належать разом (тобто матимуть однакові візуальні атрибути та є частиною одного посилання), назад в одну форму ([Menu bar --> Edit -> Grouping/Merging --> Merge selected shapes]).

- Вилучити опуклу оболонку: дозволяє спростити сітку, перетворивши її на опуклу оболонку. Доступ до цієї функції можна отримати за допомогою [Menu bar --> Edit --> Morph selection into convex shapes].

- Знищити сітку: дозволяє зменшити кількість трикутників у сітці. Доступ до цієї функції можна отримати за допомогою [Menu bar --> Edit --> Decimate selected shape...].
Немає заздалегідь визначеного порядку, у якому вищезгадані функції можуть/потрібно застосовуватися (за винятком першого елемента у списку, який завжди слід пробувати першим), це сильно залежить від геометрії сітки, яку ми намагаємося спростити. Наступне зображення ілюструє наведені вище функції, застосовані до імпортованої сітки (припустімо, що перший елемент у списку не спрацював для нас):

![image](image.png)

[Опукла оболонка та розрізана сітка]

Зверніть увагу, що опукла оболонка не допомагає нам на цьому етапі. Ми вирішуємо спочатку використати функцію децимації сітки, а потім запускаємо функцію двічі, щоб розділити кількість трикутників на загальну суму 50. У підсумку ми отримуємо сітку, яка містить 2660 трикутників (оригінальна імпортована сітка містила понад 136 000 трикутників!). Кількість трикутників/вершин фігури можна побачити в діалоговому вікні геометрії фігури. 2660 трикутників — це надзвичайно мало трикутників для цілої моделі робота, і від цього візуальний вигляд може трохи постраждати.
На цьому етапі ми можемо почати розділяти робота на окремі ланки (пам’ятайте, що зараз у нас є лише одна форма для всього робота). Це можна зробити двома способами:
- Автоматичне поділ сітки: ця функція, яка вже була описана в попередньому розділі, перевірить форму та створить нову форму для всіх елементів, які не з’єднані між собою спільним краєм. Це не завжди працює, але завжди варто спробувати. Доступ до цієї функції можна отримати за допомогою [Рядок меню --> Редагувати --> Групування/об’єднання --> Розділити вибрані фігури].
- Поділ сітки вручну: за допомогою режиму редагування трикутника ви можете вручну вибрати трикутники, які логічно належать разом, а потім натиснути «Витягнути форму». Це створить нову форму сцени. Видаліть вибрані трикутники після цієї операції.

У випадку нашої сітки метод 1 спрацював нормально:

![modelTut5](modelTut5.jpg)

[Розділена сітка]

Тепер ми можемо ще більше вдосконалити/спростити окремі форми. Іноді також форма може виглядати краще, якщо замість неї використовувати її опуклу оболонку. В інших випадках, щоб отримати бажаний результат, вам доведеться повторно використовувати кілька описаних вище прийомів. Візьмемо, наприклад, наступну сітку:

![modelTut6](modelTut6.jpg)

[Імпортована сітка]

Проблема з наведеною вище формою полягає в тому, що ми не можемо її красиво спростити через отвори, які вона містить. Тож нам доведеться піти складнішим шляхом через режим редагування форми, де ми можемо витягувати окремі елементи, які логічно належать до тієї самої опуклої суб-сутності. Цей процес може тривати кілька ітерацій: спочатку ми виділяємо 3 приблизних опуклих елемента. Наразі ми ігноруємо трикутники, які є частиною двох отворів. Під час редагування форми в режимі редагування форми може бути зручно перемикати шари видимості, щоб побачити, що закрито іншими елементами сцени.

![modelTut7](modelTut7.jpg)

[Крок 1]

У підсумку ми маємо інструмент із трьох форм, але дві з них потребують подальшого вдосконалення. Тепер ми можемо стерти трикутники, які є частиною отворів. Нарешті, ми витягуємо опуклу оболонку окремо для 3 фігур, а потім об’єднуємо їх разом за допомогою [Menu bar --> Edit --> Grouping/Merging --> merge selected shapes]:![modelTut8](https://user-images.githubusercontent.com/121936602/217019549-72987bd1-8db5-4fb9-841b-d5fd67e862ba.jpg)

[Крок 2]
